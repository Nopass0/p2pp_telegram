# P2P Transactions Telegram Bot - Описание проекта

## Общее описание
Это Telegram-бот для управления и мониторинга P2P-транзакций. Бот позволяет отслеживать рабочее время сотрудников, анализировать данные по транзакциям и управлять пользователями системы. Проект разработан с использованием Telegraf.js, TypeScript, Prisma ORM и PostgreSQL.

## Функциональные модули

### Авторизация и управление пользователями
- Система аутентификации по уникальному коду-паролю
- Автоматическое определение администраторов по ID Telegram
- Управление пользователями: создание, редактирование, удаление, просмотр статистики
- Привязка Telegram-аккаунтов к виртуальным пользователям

### Рабочие сессии
- Начало и завершение рабочих сессий
- Автоматическое завершение сессий при неактивности (>24 часов)
- Просмотр информации о текущей сессии
- Статистика рабочего времени

### Транзакции и отчеты
- Загрузка CSV-файлов с данными о транзакциях
- Парсинг и сохранение транзакций в базу данных
- Формирование статистики по транзакциям
- Система уведомлений о необходимости загрузки отчетов

### Административный интерфейс
- Панель управления пользователями
- Статистика по всей системе
- Настройка системных параметров
- Управление уведомлениями

## Архитектура проекта

### Слой интерфейса (Bot layer)
- Инициализация бота и обработка команд
- Компоненты пользовательского интерфейса (клавиатуры, меню)
- Обработчики команд и сообщений

### Сервисный слой (Services)
- Бизнес-логика приложения, разделенная на отдельные сервисы
- Взаимодействие с базой данных через Prisma ORM
- Обработка и анализ данных

### Хранение данных
- База данных PostgreSQL с Prisma ORM
- Схема базы данных:
  - User - пользователи системы
  - TelegramAccount - связанные аккаунты Telegram
  - WorkSession - рабочие сессии
  - Transaction - данные по транзакциям
  - ReportNotification - уведомления о загрузке отчетов

## Текущее состояние проекта

### Реализованные функции
- Базовый функционал аутентификации пользователей
- Создание и управление виртуальными пользователями
- Начало и завершение рабочих сессий
- Загрузка и парсинг CSV-файлов с транзакциями
- Базовый административный интерфейс

### Текущие проблемы
- Проблемы с сохранением состояния сессии при добавлении пользователей
- Ошибки при обработке изменения имен пользователей
- Дублирование аккаунтов администраторов при авторизации
- Отсутствие пагинации и полной функциональности для управления пользователями

### Недавние изменения
1. Исправление инициализации полей сессии для надежного хранения состояния
2. Обновление AdminHandler для улучшенной обработки команд управления пользователями
3. Добавление функционала удаления пользователей с подтверждением действия
4. Улучшение обработки ошибок и логирования действий
5. Модификация клавиатуры управления пользователями с добавлением кнопки удаления

## Планируемые улучшения
- Реализация полноценной пагинации для списков пользователей и транзакций
- Улучшение интерфейса администратора с детальным просмотром данных о пользователях
- Добавление возможности коррекции рабочих сессий
- Расширенный функционал для анализа и экспорта статистики
- Оптимизация работы с базой данных и улучшение производительности

## Технический стек
- **Язык программирования**: TypeScript
- **Среда выполнения**: Bun (вместо Node.js)
- **Фреймворк для бота**: Telegraf.js
- **База данных**: PostgreSQL
- **ORM**: Prisma
- **Дополнительные библиотеки**: csv-parse, dotenv, axios
